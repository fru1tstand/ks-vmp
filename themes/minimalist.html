<style type="text/css">
	html, body {
		padding: 0;
		margin: 0;
		height: 100%;
		color: #FFF;
		font-family: "Open Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
	}

	#background {
		position: absolute;
		top:0;
		right:0;
		bottom:0;
		left:0;
		background-color: #000;
	}
	
	.spectrum {
		height: 500px;
		width:100%;
		margin: 30px 0 0 0;
		padding: 0;
		text-align: center;
	}
	
	#spectrum_container {
		display: inline; 
		padding: 0;
		margin: 0;
		border: none none;
	}
	#spectrum_container div {
		display: inline-block;
		width: .75%;
		background-color: transparent;
		height:0px;
		vertical-align:bottom;
		border-top: 1px solid #FFF;
		border-bottom: 1px solid #FFF;
		margin:0;
		padding: 0;
		max-width: 8px;
	}
	.spectrum_baseline {
		display:inline-block;
		width: 0;
		margin: 0;
		padding: 0;
		vertical-align:bottom;
		height: 100%;
	}
	
	.signature {
		max-width: 1024px;
		width: 96%;
		margin:0px auto 15px;
	}
	#time_string {
		color:#FFF;
	}
	
	#timebar {
		background-color: transparent;
		text-align: left;
		cursor: pointer;
		
		width: 76.8%;
		max-width: 1024px;
		margin: 0 auto;
		
		height:20px;
		border:none;
		border-bottom: 1px solid transparent;
	}
	#timebar:hover {
		border-bottom: 1px solid #222;
	}
	#timebar_current {
		border: 1px solid #FFF;
		border-bottom:none;
		border-top:none;
		width: 20%;
		margin: 0;
		padding: 0;
		height:5px;
	}
	#timebar_offset {
		width:100%;
		height:15px;
		background:transparent;
	}
	
	#controls {
		margin-top: 50px;
		width: 96%;
		max-width: 1024px;
		margin: 0px auto;
	}
</style>

<div id="background">
	<div class="spectrum">
		<div class="spectrum_baseline"></div>
		<div id="spectrum_container"></div>
		<div class="spectrum_baseline"></div>
	</div>
	<div id="timebar"><div id="timebar_offset"></div><div id="timebar_current"></div></div>
	<div class="signature">
		<div id="time_string"></div>
	</div>
	
	<div id="controls">
		<button id="button_play" class="music_control">Play</button>
		<button id="button_stop" class="music_control">Stop</button>
		<button id="button_pause" class="music_control">Pause</button>
		<span id="fps" style="color:#FFF"></span>
		<div>
			<input type="file" id="input_songs" webkitdirectory multiple>
		</div>
	</div>
</div>

<script src="/visualmusicproject/js/Spectrum.js"></script>
<script src="/visualmusicproject/js/AnimateUpdate.js"></script>
<script src="/visualmusicproject/js/Playlist.js"></script>
<script>
	document.getElementById('input_songs').onchange = function() {
 		system.playlist.add(this.files);
	};
	
	document.getElementById('button_stop').onclick = function() {
		system.audioPlayer.stop(true);
	};
	document.getElementById('button_play').onclick = function() {
		system.playlist.play();
	};
	document.getElementById('button_pause').onclick = function() {
		system.audioPlayer.pause();
	};

	var vis = new Spectrum("freq_", 128, "squared");
	vis.createDOM("spectrum_container").bindToDOM();
	
	var animateUpdate = new AnimateUpdate();
	var fpsCounter = document.getElementById("fps");
	var timer = document.getElementById("time_string");
	var cPlayTime = 0;
	var timebar = document.getElementById("timebar_current");
	var timebar_scrub = document.getElementById("timebar");
	
	animateUpdate.setCallback(function(pDiff) {
		vis.update(system.audioPlayer.getFrequencyData());
		fpsCounter.innerHTML = (1 / pDiff * 1000 + " ups");
		cPlayTime = system.audioPlayer.getPlayTime();
		timer.innerHTML = (Math.floor(cPlayTime/60) + ":" + ((cPlayTime % 60 < 10) ? "0" : "") + Math.floor(cPlayTime % 60));
		timebar.style.width = Math.min(cPlayTime / system.audioPlayer.getCurrentAudioLength() * 100, 100) + "%";
	});
	
	timebar_scrub.onclick = function(e) {
		if(system.audioPlayer.isAudioReady()) {
			system.audioPlayer.seek((e.clientX - e.currentTarget.offsetLeft) / e.currentTarget.clientWidth + "%");
		}
	};
	
	animateUpdate.start();

	function destroy(p_callback) {
		animateUpdate.stop();
		animateUpdate.setCallback(null);
		vis = null;
		animateUpdate = null
		fpsCounter = null;
		timebar = null;
		timebar_scrub = null;
		
		if(system.isMethod(p_callback))
			p_callback();
	};
</script>
